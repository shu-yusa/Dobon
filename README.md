# Dobon
auのオープンアプリのプロジェクトです。

## AppletViwerでの実行
```bash
appletviewer applet.html
```

##ドボンとは - ルール説明 -##
ドボンはページワンやアメリカンページワンと似たトランプゲームで、2人以上で行うゲームです(アプリでは2 ~ 4人対戦が可能です)。様々なローカルルールが存在するようですが、本アプリでは以下のようなルールを採用しています。

###ゲームの流れ###
まず、シャッフルされた52枚のカード(本アプリではジョーカーは除いてあります)から各プレイヤーに5枚ずつカードを配り、場に1枚のカードを表にして置きます。それぞれ手札、場札と呼ぶことにします。残りのカードは山札として、裏にして積んでおきます。この状態からゲームが始まり、親から時計回りに順番が回ります。親は前回のゲームの勝者です(アプリでは初回の親は自分です)。

各ターンでプレイヤーは手札を1枚場に出すか、あるいは山札から1枚引いて手札に加えます。手札を全て場に出し切る(ストップ)か、ドボンと呼ばれる上がり方をすると、その回のゲームの勝敗が決まります。

アプリではプレイヤーの誰かの持ち点がマイナスになった時点で全てのゲームが終了し、最終的な勝敗が決定します。最初の持ち点は、アプリの「オプション」項目で設定できます。

###各ターンでの行動###
自分の番が回ってきたときにどの手札を場に出せるは、場札により決まります。出せるカードは場札と同じマークのカードか、場札と同じ数字のカードです。例えばハートの3が場札の場合(図1)、出せるカードはハートのカードあるいはスペード、ダイア、クラブの3です。図1の場合であれば、スペードの3またはハートの7を出すことができます。アプリでは決定キーで手札を場に出す事が出来ます。

出せるカードが手札に無い場合は山札から1枚カードを引かなければなりません。また、出せるカードが手札にある場合でも山札からカードを引くことができます(引いた時点でターン終了になります)。アプリでは下キーを押すことで山札からカードを引くことができます。山札のカードが無くなった場合は、場に出された古いカードがシャッフルされて山札になります。

![fig1.png](https://bitbucket.org/repo/oyXobb/images/96683184-fig1.png "図1")
図1

###2と8のカードについて###
2と8のカードは特殊なカードです。まず、8について説明します。8を場に出したプレイヤーは場札のマークを自由に変更することができます。例えば図2、3のようにスペードの8を出して場のマークをダイアに変えた場合、次のプレイヤーが出せるカードばダイアのカードか8のカードになります。

![fig2.png](https://bitbucket.org/repo/oyXobb/images/2467151967-fig2.png "図2")
図2

![fig3.png](https://bitbucket.org/repo/oyXobb/images/3731763054-fig3.png "図3\(ダイアに変更\)")
図3(ダイアに変更)

次に2について説明します。あるプレイヤーが2を出した場合、次のプレイヤーは2を出すかあるいは山札から2枚カードを引かなければなりません(図4)。したがって、手札に2が1枚も無ければ、必ずカードを引く事になります。ここで2を出した場合、その次のプレイヤーは2を出すかあるいは山札から4枚カードを引かなければなりません(図5)。さらにここで2を出した場合、引くべきカードの枚数は6枚になります。このように2のカードが場に出た場合、次のプレイヤーは2を出すか、(連続して出た2の枚数)×2枚のカードを引かなければならなくなります。

![fig4.png](https://bitbucket.org/repo/oyXobb/images/1015557540-fig4.png "図4\(スペードの2を出した\)")
図4(スペードの2を出した)

![fig5.png](https://bitbucket.org/repo/oyXobb/images/615574831-fig5.png "図5\(次のﾌﾟﾚｲﾔｰも2を出した\)")
図5(次のﾌﾟﾚｲﾔｰも2を出した)

###ドボンについて###
ゲームの名前にもなっているドボンは上がり方の一つであり、このゲームで最も面白く重要なイベントです。あるプレイヤーが場にカードを出した際に、自分の手札の数字の合計が出された場札の数字と一致していれば、「ドボン」と宣言して上がることができます。例えば、あるプレイヤーの出したカードが10で、手札の数字が[1、2、3、4]や[4、6]だった場合(図6、7)、ドボンをすることができます。また、場に出されたカードが「ストップ」で出されたカードの場合でもドボンができます。ただし、手札が1枚だけの場合ドボンをすることはできません。

![fig6.png](https://bitbucket.org/repo/oyXobb/images/1938766907-fig6.png "図6")
図6

![fig7.png](https://bitbucket.org/repo/oyXobb/images/3542392784-fig7.png "図7\(正面のﾌﾟﾚｲﾔｰが10を出した\)")
図7(正面のﾌﾟﾚｲﾔｰが10を出した)

アプリではドボンが可能な時、ソフトキー(携帯画面の右下)に「ドボン」と表示されるので(図7)、ドボンをする場合はソフトキーを押してください。ドボンができるのにずっとキーを押さずにいると次のプレイヤーがカードを出してしまいます(他のプレイヤーはあなたがドボンできることを知らないので)。また、自分のターンのときにドボンができる場合(すなわち、自分の前のプレイヤーが出したカードにドボンできる場合)であっても、あえてドボンせずに普通にカードを出したり、山札からカードを引くことも可能です。

ドボンをすると手札が公開されます(図8)。ドボンをしたプレイヤーは勝者になり、されたプレイヤーは敗者になります。残りのプレイヤーは勝敗とは無関係です。

ただし、出された場札に対し、2人以上のプレイヤーがドボンをした場合は、最後にドボンをしたプレイヤーが勝者となり、その直前にドボンをしたプレイヤー(最初に場にカードを出したプレイヤーではない)が敗者となります(図9)。

![fig8.png](https://bitbucket.org/repo/oyXobb/images/3236254135-fig8.png "図8")
図8

![fig9.png](https://bitbucket.org/repo/oyXobb/images/4038735061-fig9.png "図9")
図9

ドボンをせずにいると次のプレイヤーがカードを出してしまい、かといってドボンをするタイミングが早すぎると他のプレイヤーに上からドボンされてしまうかもしれません。うまくタイミングを見計らう必要があります。

###ドボン返しについて###
ドボンをされたプレイヤーは、残りの手札の数字の合計が自分の出した場札のカードの数字と一致する場合に、「ドボン返し」をすることができます。例えば、手札が[3、7、10]で、場に10のカードを出して(図10)他のプレイヤーにドボンをされた場合(図11)、ドボン返しが可能です。ドボン返しが可能な場合、ソフトキーに「ドボン」と表示されるのでソフトキーを押してください。ドボン返しは他プレイヤーにドボンをされた時のみに可能です。このときはドボン返しをしたプレイヤーが勝者となり、ドボン返しされたプレイヤーが敗者となります(図12)。

![fig10.png](https://bitbucket.org/repo/oyXobb/images/2755516703-fig10.png "図10\(ダイアの10を出した\)")
図10(ダイアの10を出した)

![fig11.png](https://bitbucket.org/repo/oyXobb/images/3175531293-fig11.png "図11\(ドボンされた\)")
図11(ドボンされた)

ただし、2人以上のプレイヤーがドボン可能で、場にカードを出したプレイヤーがドボン返し可能な場合は、最後にドボン(返し)をしたプレイヤーが勝者となり、その直前にドボン(返し)をしたプレイヤーが敗者となります(図13)。

![fig12.png](https://bitbucket.org/repo/oyXobb/images/3134593162-fig12.png "図12\(ドボン返し\)")
図12(ドボン返し)

![fig13.png](https://bitbucket.org/repo/oyXobb/images/3647630592-fig13.png "図13\(その上からドボンをされた\)")
図13(その上からドボンをされた)

###スコア計算について###
ストップ時はストップしたプレイヤー以外の全プレイヤーが敗者となります。敗者は持っているカードの数字の合計値から、勝者に払う点数を求めます。ただし合計値を求める際は、エースと絵札は10点と数え、2^(持っている2の枚数)分だけ合計値を倍にして点数にします(^はべき乗を表す。最大16倍)。例えば、持っているカードが[1、2、2、5、J]の場合、29×22 = 29×4 = 116点が支払う点数になります。

ドボン時は勝者と敗者はそれぞれ1人ずつであり、2人の手札とドボンの元になった場札の合計値から点数を求めます。合計値の計算法はストップ時と同様ですが、2の枚数分に加えてドボン(返し)の回数分さらに点数が倍になります。

このように、2を持ったままドボンで勝つと高得点になりますが、逆に2を持ったまま負けると大失点になります。ここがドボンの面白い点の一つでもあります。
